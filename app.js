!function(e){function i(i){for(var s,n,l=i[0],d=i[1],r=i[2],c=0,g=[];c<l.length;c++)n=l[c],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&g.push(a[n][0]),a[n]=0;for(s in d)Object.prototype.hasOwnProperty.call(d,s)&&(e[s]=d[s]);for(h&&h(i);g.length;)g.shift()();return o.push.apply(o,r||[]),t()}function t(){for(var e,i=0;i<o.length;i++){for(var t=o[i],s=!0,l=1;l<t.length;l++){var d=t[l];0!==a[d]&&(s=!1)}s&&(o.splice(i--,1),e=n(n.s=t[0]))}return e}var s={},a={0:0},o=[];function n(i){if(s[i])return s[i].exports;var t=s[i]={i:i,l:!1,exports:{}};return e[i].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=e,n.c=s,n.d=function(e,i,t){n.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,i){if(1&i&&(e=n(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var s in e)n.d(t,s,function(i){return e[i]}.bind(null,s));return t},n.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(i,"a",i),i},n.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},n.p="";var l=window.webpackJsonp=window.webpackJsonp||[],d=l.push.bind(l);l.push=i,l=l.slice();for(var r=0;r<l.length;r++)i(l[r]);var h=d;o.push([0,1]),t()}([function(e,i,t){const{default:s}=t(1),{default:a}=t(3);var o={backgroundColor:"#917C62",type:Phaser.AUTO,scene:[a],scale:{mode:Phaser.Scale.RESIZE,parent:"main-scene",width:"100%",height:"100%"},antialias:!0,pixelArt:!1,physics:{default:"arcade",arcade:{debug:!1}},plugins:{scene:[{plugin:s,key:"matterCollision",mapping:"matterCollision"}]}};new Phaser.Game(o)},,,function(e,i,t){"use strict";t.r(i),t.d(i,"default",(function(){return l}));class s extends class{constructor(e){this.scene=e}}{constructor(e){super(e)}initStaticComponents(){this.scene.bg=this.scene.add.sprite(this.scene.scale.gameSize.width/2,this.scene.scale.gameSize.height/2,"bg"),this.scene.bgTile=this.scene.add.sprite(this.scene.scale.gameSize.width/2,this.scene.scale.gameSize.height/2,"bg-tile"),this.scene.bg.setScale(this.scene.scale.gameSize.width/this.scene.bg.width,this.scene.scale.gameSize.height/this.scene.bg.height)}initAnimate(){this.scene.explode={key:"explode",frames:"boom",frameRate:60},this.scene.anims.create(this.scene.explode)}performSwap(e,i){var t=e.x,s=e.y;this.scene.tweens.timeline({ease:"linear",duration:100,tweens:[{targets:e,x:{from:e.x,to:i.x},y:{from:e.y,to:i.y},offset:0},{targets:i,x:{from:i.x,to:t},y:{from:i.y,to:s},offset:0}],onComplete:t=>this.scene.logic.performMatchingCandies(e,i)}),e.onPointUp(),i.onPointUp()}performSwapBack(e,i){console.log("Nothing happens after swapping");var t=e.x,s=e.y;console.log("Before tween BACK Candy x "+e.x+"-y "+e.y+" || Candy2 x "+i.x+"-y "+i.y);this.scene.tweens.timeline({ease:"linear",duration:100,delay:10,tweens:[{targets:e,x:{from:e.x,to:i.x},y:{from:e.y,to:i.y},offset:0},{targets:i,x:{from:i.x,to:t},y:{from:i.y,to:s},offset:0}],onComplete:t=>console.log("CALLBACK BACK tween Candy x "+e.x+"-y "+e.y+" || Candy2 x "+i.x+"-y "+i.y)})}moveTween(e){this.scene.tweens.timeline({ease:"linear",duration:200,delay:10,tweens:e,onComplete:e=>console.log("TOPDOWN tween Candy")})}}class a extends Phaser.Physics.Arcade.Sprite{constructor(e,i,t,s,a,o=!1){if(0==o)switch(s){case 1:super(e.scene,e.x,e.y,"cake");break;case 2:super(e.scene,e.x,e.y,"donut");break;case 3:super(e.scene,e.x,e.y,"maracon");break;case 4:super(e.scene,e.x,e.y,"rolls")}else switch(s){case 1:super(e.scene,e.x,e.y,"treasure-s"),s=11;break;case 2:super(e.scene,e.x,e.y,"phone-s"),s=12;break;case 3:super(e.scene,e.x,e.y,"zlp-coin-s"),s=13;break;case 4:super(e.scene,e.x,e.y,"watch-s"),s=14}this.initMetrics(e,s,i,t,a),this.depth=1e3}initMetrics(e,i,t,s,a){this.setScale(e.scaleWidth,e.scaleHeight),this.rowIdx=t,this.colIdx=s,this.type=i,this.tileSprite=a,this.clicked=!1,this.dragDeltaX=.5*this.scene.logic.tileWidthAtScale,this.dragDeltaY=.5*this.scene.logic.tileHeightAtScale,this.dragDelta=30,this.minDragDistance=1,this.pointdown=!1,this.setInteractive(),this.scene.input.setDraggable(this),this.scene.physics.add.existing(this),this.scene.add.existing(this),this.draggable=!0,this.on("drag",this.onDrag),this.on("dragend",this.onDragEnd),this.on("pointerdown",this.onPointDown),this.on("pointerout",this.onPointOut),this.on("pointerup",this.onPointUp),this.depth=1}setNewLogicalPos(e,i){this.rowIdx=e,this.colIdx=i}onPointDown(){console.log("Candy "+this.rowIdx+" - "+this.colIdx+" Down"),this.pointdown=!0,this.setTint(16776876),this.tileSprite.onPointDown()}onPointOut(){this.clearTint(),this.tileSprite.onPointUp()}onPointUp(){this.pointdown=!1,this.clearTint(),this.tileSprite.onPointUp()}onDrag(e,i,t){if(0==this.draggable)return!1;var s=i-this.x,a=t-this.y;return!(Math.abs(a-s)<this.dragDelta)&&(!(Math.abs(s)<this.dragDeltaX&&Math.abs(a)<this.dragDeltaY)&&(s>this.dragDeltaX*this.minDragDistance?this.colIdx==this.scene.logic.numCol-1?(this.draggable=!1,!1):(console.log("Candy "+this.rowIdx+" - "+this.colIdx+"  Right"),this.draggable=!1,this.scene.onSwapCandy(this,{x:0,y:1}),!0):s<-1*this.dragDeltaX*this.minDragDistance?0==this.colIdx?(this.draggable=!1,!1):(console.log("Candy "+this.rowIdx+" - "+this.colIdx+"  Left"),this.draggable=!1,this.scene.onSwapCandy(this,{x:0,y:-1}),!0):a>this.dragDeltaY*this.minDragDistance?this.rowIdx==this.scene.logic.numRow-1?(this.draggable=!1,!1):(console.log("Candy "+this.rowIdx+" - "+this.colIdx+"  Down"),this.draggable=!1,this.scene.onSwapCandy(this,{x:1,y:0}),!0):a<-1*this.dragDeltaY*this.minDragDistance?0==this.rowIdx?(this.draggable=!1,!1):(console.log("Candy "+this.rowIdx+" - "+this.colIdx+"  Up"),this.draggable=!1,this.scene.onSwapCandy(this,{x:-1,y:0}),!0):(this.draggable=!1,!1)))}onDragEnd(e,i,t,s){this.draggable=!0,this.tileSprite.setTexture("tiles")}}class o extends Phaser.GameObjects.Sprite{constructor(e,i,t,s){s%2==1?(super(e.scene,e.x,e.y,"tiles-dark"),this.type=1):(super(e.scene,e.x,e.y,"tiles-light"),this.type=2),this.setScale(e.scaleWidth,e.scaleHeight),this.rowIdx=i,this.colIdx=t,this.candySprite=null,this.setInteractive(),this.scene.input.setDraggable(this),this.draggable=!0,this.on("drag",this.onDrag),this.on("dragend",this.onDragEnd),this.on("pointerdown",this.onPointDown),this.on("pointerup",this.onPointUp),this.depth=0}onPointDown(){console.log("Tiles "+this.rowIdx+" - "+this.colIdx+" Down"),this.setTexture("tiles-selected"),this.pointup=!1}onPointUp(){this.setTexture("tiles"),this.type%2==1?this.setTexture("tiles-dark"):this.setTexture("tiles-light")}onDrag(e,i,t){0!=this.draggable&&1==this.candySprite.onDrag(e,i,t)&&(this.draggable=!1)}onDragEnd(e,i,t,s){this.draggable=!0,this.candySprite.onDragEnd(e,i,t,s),this.type%2==1?this.setTexture("tiles-dark"):this.setTexture("tiles-light")}}class n extends class{constructor(e){this.scene=e}}{constructor(e){super(e),this.tilesImage=null,this.numRow=0,this.numCol=0,this.colBuffer=50,this.rowBuffer=350,this.tileWidthAtScale=0,this.tileHeightAtScale=0,this.tileScaleWidth=1,this.tileScaleHeight=1,this.mortarBuffer=4,this.logicalCandyGrid=null,this.logicalTileGrid=null,this.level=null,this.originX=0,this.originY=0,this.tileGrid=null,this.candyGrid=null}initLevel(){console.log(""),this.level=this.scene.cache.json.get("level")}initMetrics(){this.numRow=this.level.tiles.length,this.numCol=this.level.tiles[0].length,this.tilesImage=this.scene.textures.get("tiles-light").getSourceImage(),this.scene.scale.gameSize.width<this.tilesImage.width*this.numCol+this.colBuffer?(this.tileWidthAtScale=this.tilesImage.width*(this.scene.scale.gameSize.width/(this.tilesImage.width*this.numCol+this.colBuffer)),this.tileScaleWidth=this.tileWidthAtScale/this.tilesImage.width):this.tileWidthAtScale=this.tilesImage.width,this.scene.scale.gameSize.height<this.tilesImage.height*this.numRow+this.rowBuffer?(this.tileHeightAtScale=this.tilesImage.height*(this.scene.scale.gameSize.height/(this.tilesImage.height*this.numRow+this.rowBuffer)),this.tileScaleHeight=this.tileHeightAtScale/this.tilesImage.height):this.tileHeightAtScale=this.tilesImage.height,this.tileScaleHeight<this.tileScaleWidth?(this.tileScaleWidth=this.tileScaleHeight,this.tileWidthAtScale=this.tilesImage.width*this.tileScaleWidth):(this.tileScaleHeight=this.tileScaleWidth,this.tileHeightAtScale=this.tilesImage.height*this.tileScaleHeight),this.calculateOriginGrid()}initGrid(){var e=0,i=-1*this.tileHeightAtScale;this.tileGrid=this.scene.add.container(this.originX,this.originY),this.candyGrid=this.scene.add.container(this.originX,this.originY),this.logicalCandyGrid=new Array(this.numRow),this.logicalTileGrid=new Array(this.numRow);for(var t=0;t<this.level.tiles.length;t++){i+=this.tileHeightAtScale+this.mortarBuffer,this.logicalCandyGrid[t]=new Array(this.numCol),this.logicalTileGrid[t]=new Array(this.numCol);for(var s=0;s<this.level.tiles[0].length;s++){if(0!=this.level.tiles[t][s]){var n=new o({scene:this.scene,x:e,y:i,scaleWidth:this.tileScaleWidth,scaleHeight:this.tileScaleHeight},t,s,this.numCol*t+s),l=new a({scene:this.scene,x:e,y:i,scaleWidth:this.tileScaleWidth,scaleHeight:this.tileScaleHeight},t,s,this.level.tiles[t][s],n);n.candySprite=l,this.tileGrid.add(n),this.candyGrid.add(l),this.logicalCandyGrid[t][s]=l,this.logicalTileGrid[t][s]=n}e+=this.tileWidthAtScale+this.mortarBuffer}e=0}}calculateOriginGrid(){this.originX=this.scene.cameras.main.centerX-(this.tileWidthAtScale+this.mortarBuffer)*((this.numCol-1)/2),this.originY=this.scene.cameras.main.centerY-this.tileHeightAtScale*((this.numRow-.5)/2)}resize(e){var i=e.width,t=e.height;this.scene.cameras.resize(i,t),this.scene.bg.setPosition(i/2,t/2),this.scene.bgTile.setPosition(i/2,t/2),this.scene.bg.setScale(this.scene.scale.gameSize.width/this.scene.bg.width,this.scene.scale.gameSize.height/this.scene.bg.height),this.calculateOriginGrid(),this.tileGrid.setPosition(this.originX,this.originY),this.candyGrid.setPosition(this.originX,this.originY)}onSwapCandy(e,i){var t=this.logicalCandyGrid[e.rowIdx+i.x][e.colIdx+i.y];this.swapCandies(e,t),console.log("Before tween Candy x "+e.x+"-y "+e.y+" || Candy2 x "+t.x+"-y "+t.y),this.scene.animMain.performSwap(e,t)}performMatchingCandies(e,i){var t=this.detectValidMove(e,i);console.log(t),1==t.possible?(this.performCrushing(t),this.performTopup(t)):(this.scene.animMain.performSwapBack(e,i),this.swapCandies(e,i))}swapCandies(e,i){this.logicalCandyGrid[e.rowIdx][e.colIdx]=i,this.logicalCandyGrid[i.rowIdx][i.colIdx]=e;var t=e.rowIdx,s=e.colIdx;e.rowIdx=i.rowIdx,e.colIdx=i.colIdx,i.rowIdx=t,i.colIdx=s;var a=e.tileSprite;e.tileSprite=i.tileSprite,i.tileSprite=a,i.tileSprite.candySprite=i,e.tileSprite.candySprite=e}detectValidMove(e,i){var t=new Object;t.possible=!1,t.candy=new Object,t.candyToSwap=new Object,t.candy.colCandies=[],t.candy.rowCandies=[],t.candyToSwap.colCandies=[],t.candyToSwap.rowCandies=[];var s=1,a=e.rowIdx-1;for(t.candy.type=e.type,t.candy.x=e.x,t.candy.y=e.y,t.candyToSwap.x=i.x,t.candyToSwap.y=i.y,t.holeCol=new Set,t.candyToSwap.type=i.type,t.candy.colCandies.push({rowIdx:e.rowIdx,colIdx:e.colIdx});a>-1&&e.type==this.logicalCandyGrid[a][e.colIdx].type;)t.candy.colCandies.push({rowIdx:a,colIdx:e.colIdx}),a--,s++;for(a=e.rowIdx+1;a<this.numRow&&e.type==this.logicalCandyGrid[a][e.colIdx].type;)t.candy.colCandies.push({rowIdx:a,colIdx:e.colIdx}),a++,s++;s>=3?(t.possible=!0,t.holeCol.add(e.colIdx),console.log("Detected First Col"+JSON.stringify(t.candy.colCandies))):t.candy.colCandies=[];var o=1,n=e.colIdx-1;for(t.candy.rowCandies.push({rowIdx:e.rowIdx,colIdx:e.colIdx});n>-1&&e.type==this.logicalCandyGrid[e.rowIdx][n].type;)t.candy.rowCandies.push({rowIdx:e.rowIdx,colIdx:n}),n--,o++;for(n=e.colIdx+1;n<this.numCol&&e.type==this.logicalCandyGrid[e.rowIdx][n].type;)t.candy.rowCandies.push({rowIdx:e.rowIdx,colIdx:n}),n++,o++;o>=3?(t.possible=!0,t.candy.rowCandies.forEach((e=>{t.holeCol.add(e.colIdx)})),console.log("Detected First Row"+JSON.stringify(t.candy.rowCandies))):t.candy.rowCandies=[];s=1,a=i.rowIdx-1;for(t.candyToSwap.colCandies.push({rowIdx:i.rowIdx,colIdx:i.colIdx});a>-1&&i.type==this.logicalCandyGrid[a][i.colIdx].type;)t.candyToSwap.colCandies.push({rowIdx:a,colIdx:i.colIdx}),a--,s++;for(a=i.rowIdx+1;a<this.numRow&&i.type==this.logicalCandyGrid[a][i.colIdx].type;)t.candyToSwap.colCandies.push({rowIdx:a,colIdx:i.colIdx}),a++,s++;s>=3?(t.possible=!0,t.holeCol.add(i.colIdx),console.log("Detected sencond Col"+JSON.stringify(t.candyToSwap.colCandies))):t.candyToSwap.colCandies=[];o=1,n=i.colIdx-1;for(t.candyToSwap.rowCandies.push({rowIdx:i.rowIdx,colIdx:i.colIdx});n>-1&&i.type==this.logicalCandyGrid[i.rowIdx][n].type;)t.candyToSwap.rowCandies.push({rowIdx:i.rowIdx,colIdx:n}),n--,o++;for(n=i.colIdx+1;n<this.numCol&&i.type==this.logicalCandyGrid[i.rowIdx][n].type;)t.candyToSwap.rowCandies.push({rowIdx:i.rowIdx,colIdx:n}),n++,o++;return o>=3?(t.possible=!0,t.candyToSwap.rowCandies.forEach((e=>{t.holeCol.add(e.colIdx)})),console.log("Detected sencond Row"+JSON.stringify(t.candyToSwap.rowCandies))):t.candyToSwap.rowCandies=[],t}performCrushing(e){this.destroyCandies(e.candy.colCandies),this.destroyCandies(e.candy.rowCandies),this.destroyCandies(e.candyToSwap.colCandies),this.destroyCandies(e.candyToSwap.rowCandies)}destroyCandies(e){e.forEach((e=>{var i=this.logicalCandyGrid[e.rowIdx][e.colIdx];null!=i&&(i.play("explode"),i.once(Phaser.Animations.Events.ANIMATION_COMPLETE,(()=>{console.log("Destroyed candy "+i.rowIdx+" - "+i.colIdx),i.destroy()})),this.logicalCandyGrid[e.rowIdx][e.colIdx]=void 0,this.logicalTileGrid[e.rowIdx][e.colIdx].candySprite=void 0)}))}performCreateSpecialCandy(e){if(e.candy.colCandies.length>3){let i=e.candy.colCandies[0].rowIdx,t=e.candy.colCandies[0].colIdx;this.createCandyAtPos(e.candy.x,e.candy.y,i,t,e.candy.type)}if(e.candy.rowCandies.length>3){let i=e.candy.rowCandies[0].rowIdx,t=e.candy.rowCandies[0].colIdx;this.createCandyAtPos(e.candy.x,e.candy.y,i,t,e.candy.type)}if(e.candyToSwap.colCandies.length>3){let i=e.candyToSwap.colCandies[0].rowIdx,t=e.candyToSwap.colCandies[0].colIdx;this.createCandyAtPos(e.candyToSwap.x,e.candyToSwap.y,i,t,e.candyToSwap.type)}if(e.candyToSwap.rowCandies.length>3){let i=e.candyToSwap.rowCandies[0].rowIdx,t=e.candyToSwap.rowCandies[0].colIdx;this.createCandyAtPos(e.candyToSwap.x,e.candyToSwap.y,i,t,e.candyToSwap.type)}}createCandyAtPos(e,i,t,s,o){console.log("Create special candy at "+t+"-"+s+"!");var n=new a({scene:this.scene,x:e,y:i,scaleWidth:this.tileScaleWidth,scaleHeight:this.tileScaleHeight},t,s,o,this.logicalTileGrid[t][s],!0);this.candyGrid.add(n),this.logicalCandyGrid[t][s]=n,this.logicalTileGrid[t][s].candySprite=n}performTopup(e){var i=[];e.holeCol.forEach((e=>{let t=0;for(let s=this.numRow-1;s>=0;s--)null!=this.logicalCandyGrid[s][e]?0!=t&&(i.push({targets:this.logicalCandyGrid[s][e],x:this.logicalCandyGrid[s][e].x,y:this.logicalCandyGrid[s][e].y+t*(this.tileHeightAtScale+this.mortarBuffer),offset:0}),console.log("Slot "+(s+t)+"-"+e+" - We put Candy "+s+"-"+e),this.logicalCandyGrid[s][e].setNewLogicalPos(s+t,e),this.logicalCandyGrid[s+t][e]=this.logicalCandyGrid[s][e],this.logicalTileGrid[s+t][e].candySprite=this.logicalCandyGrid[s][e],this.logicalCandyGrid[s][e].tileSprite=this.logicalTileGrid[s+t][e],this.logicalTileGrid[s][e].candySprite=void 0,this.logicalCandyGrid[s][e]=void 0):(t++,this.logicalTileGrid[s][e].candySprite=void 0)})),e.holeCol.forEach((e=>{let t=this.numRow-1;for(console.log("Finding undefined "+t+"-"+e);t>-1&&null!=this.logicalCandyGrid[t][e];)t--;if(t<0)return;let s=this.logicalTileGrid[0][e].x,o=this.logicalTileGrid[0][e].y;for(;t>-1;){if(this.level.bufferTiles.offset[e]<0){console.log("Buffer running out for col "+e);break}let n=this.level.bufferTiles.tiles[this.level.bufferTiles.offset[e]][e];this.level.bufferTiles.offset[e]--,console.log("Gonna toptup a type "+n);let l=new a({scene:this.scene,x:s,y:o,scaleWidth:this.tileScaleWidth,scaleHeight:this.tileScaleHeight},t,e,n,this.logicalTileGrid[t][e]);this.candyGrid.add(l),this.logicalCandyGrid[t][e]=l,i.push({targets:l,x:this.logicalTileGrid[t][e].x,y:this.logicalTileGrid[t][e].y,offset:0}),t--}})),this.scene.animMain.moveTween(i)}}class l extends Phaser.Scene{constructor(){super("Main Scene!"),this.bg=null,this.bgTile=null,this.tilesImage=null,this.clickable=!0,this.logic=new n(this),this.animMain=new s(this)}preload(){console.log("Preload! This is console log!");var e="./src/assets/";this.load.image("bg",e+"bg.png"),this.load.json("level",e+"level/level-0.json"),this.load.image("tiles-light",e+"tiles-light.png"),this.load.image("tiles-dark",e+"tiles-dark.png"),this.load.image("cake",e+"cake.png"),this.load.image("chese-cake",e+"chese-cake.png"),this.load.image("flan",e+"flan.png"),this.load.image("donut-chocolate",e+"donut-chocolate.png"),this.load.image("donut",e+"donut.png"),this.load.image("maracon",e+"maracon.png"),this.load.image("flan",e+"flan.png"),this.load.image("rolls",e+"rolls.png"),this.load.image("bg-tile",e+"tile-grid.png"),this.load.image("tiles-selected",e+"tiles-selected.png"),this.load.spritesheet("boom",e+"explosion-1.png",{frameWidth:128,frameHeight:128,endFrame:15})}create(){console.log("Create! This is console log!"),this.animMain.initStaticComponents(),this.animMain.initAnimate(),this.logic.initLevel(),this.logic.initMetrics(),this.logic.initGrid(),this.scale.on("resize",this.resize,this)}update(){}resize(e,i,t,s){this.logic.resize(e)}onSwapCandy(e,i){this.logic.onSwapCandy(e,i)}performCrushing(e){this.destroyCandies(e.candy.colCandies),this.destroyCandies(e.candy.rowCandies),this.destroyCandies(e.candyToSwap.colCandies),this.destroyCandies(e.candyToSwap.rowCandies)}destroyCandies(e){e.forEach((e=>{var i=this.logicalCandyGrid[e.x][e.y];i.play("explode"),i.once(Phaser.Animations.Events.ANIMATION_COMPLETE,(()=>{console.log("Destroyed candy "+i.rowIdx+" - "+i.colIdx),i.destroy(),this.logicalCandyGrid[e.x][e.y]=void 0}))}))}}}]);