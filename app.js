!function(e){function i(i){for(var s,o,l=i[0],d=i[1],r=i[2],c=0,g=[];c<l.length;c++)o=l[c],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&g.push(a[o][0]),a[o]=0;for(s in d)Object.prototype.hasOwnProperty.call(d,s)&&(e[s]=d[s]);for(h&&h(i);g.length;)g.shift()();return n.push.apply(n,r||[]),t()}function t(){for(var e,i=0;i<n.length;i++){for(var t=n[i],s=!0,l=1;l<t.length;l++){var d=t[l];0!==a[d]&&(s=!1)}s&&(n.splice(i--,1),e=o(o.s=t[0]))}return e}var s={},a={0:0},n=[];function o(i){if(s[i])return s[i].exports;var t=s[i]={i:i,l:!1,exports:{}};return e[i].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=e,o.c=s,o.d=function(e,i,t){o.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,i){if(1&i&&(e=o(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var s in e)o.d(t,s,function(i){return e[i]}.bind(null,s));return t},o.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(i,"a",i),i},o.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},o.p="";var l=window.webpackJsonp=window.webpackJsonp||[],d=l.push.bind(l);l.push=i,l=l.slice();for(var r=0;r<l.length;r++)i(l[r]);var h=d;n.push([0,1]),t()}([function(e,i,t){const{default:s}=t(1),{default:a}=t(3);var n={backgroundColor:"#917C62",type:Phaser.AUTO,scene:[a],scale:{mode:Phaser.Scale.RESIZE,parent:"main-scene",width:"100%",height:"100%"},antialias:!0,pixelArt:!1,physics:{default:"arcade",arcade:{debug:!1}},plugins:{scene:[{plugin:s,key:"matterCollision",mapping:"matterCollision"}]}};new Phaser.Game(n)},,,function(e,i,t){"use strict";t.r(i),t.d(i,"default",(function(){return l}));class s extends class{constructor(e){this.scene=e}}{constructor(e){super(e)}initStaticComponents(){this.scene.bg=this.scene.add.sprite(this.scene.scale.gameSize.width/2,this.scene.scale.gameSize.height/2,"bg"),this.scene.bg.setScale(this.scene.scale.gameSize.width/this.scene.bg.width,this.scene.scale.gameSize.height/this.scene.bg.height)}initAnimate(){this.scene.explode={key:"explode",frames:"boom",frameRate:60},this.scene.anims.create(this.scene.explode)}performSwap(e,i){var t=e.x,s=e.y;this.scene.tweens.timeline({ease:"linear",duration:100,tweens:[{targets:e,x:{from:e.x,to:i.x},y:{from:e.y,to:i.y},offset:0},{targets:i,x:{from:i.x,to:t},y:{from:i.y,to:s},offset:0}],onComplete:t=>this.scene.logic.performMatchingCandies(e,i)}),e.onPointUp(),i.onPointUp()}performSwapBack(e,i){console.log("Nothing happens after swapping");var t=e.x,s=e.y;console.log("Before tween BACK Candy x "+e.x+"-y "+e.y+" || Candy2 x "+i.x+"-y "+i.y);this.scene.tweens.timeline({ease:"linear",duration:100,delay:10,tweens:[{targets:e,x:{from:e.x,to:i.x},y:{from:e.y,to:i.y},offset:0},{targets:i,x:{from:i.x,to:t},y:{from:i.y,to:s},offset:0}],onComplete:t=>console.log("CALLBACK BACK tween Candy x "+e.x+"-y "+e.y+" || Candy2 x "+i.x+"-y "+i.y)})}}class a extends Phaser.Physics.Arcade.Sprite{constructor(e,i,t,s,a,n=!1){if(0==n)switch(s){case 1:super(e.scene,e.x,e.y,"treasure");break;case 2:super(e.scene,e.x,e.y,"phone");break;case 3:super(e.scene,e.x,e.y,"zlp-coin");break;case 4:super(e.scene,e.x,e.y,"watch")}else switch(s){case 1:super(e.scene,e.x,e.y,"treasure-s"),s=11;break;case 2:super(e.scene,e.x,e.y,"phone-s"),s=12;break;case 3:super(e.scene,e.x,e.y,"zlp-coin-s"),s=13;break;case 4:super(e.scene,e.x,e.y,"watch-s"),s=14}this.initMetrics(e,s,i,t,a)}initMetrics(e,i,t,s,a){this.setScale(e.scaleWidth,e.scaleHeight),this.rowIdx=t,this.colIdx=s,this.type=i,this.tileSprite=a,this.clicked=!1,this.dragDeltaX=.5*this.scene.logic.tileWidthAtScale,this.dragDeltaY=.5*this.scene.logic.tileHeightAtScale,this.dragDelta=30,this.minDragDistance=1,this.pointdown=!1,this.setInteractive(),this.scene.input.setDraggable(this),this.scene.physics.add.existing(this),this.scene.add.existing(this),this.draggable=!0,this.on("drag",this.onDrag),this.on("dragend",this.onDragEnd),this.on("pointerdown",this.onPointDown),this.on("pointerout",this.onPointOut),this.on("pointerup",this.onPointUp),this.depth=1}onPointDown(){this.pointdown=!0,this.setTint(16776876),this.tileSprite.onPointDown()}onPointOut(){this.clearTint(),this.tileSprite.onPointUp()}onPointUp(){this.pointdown=!1,this.clearTint(),this.tileSprite.onPointUp()}onDrag(e,i,t){if(0==this.draggable)return!1;var s=i-this.x,a=t-this.y;return!(Math.abs(a-s)<this.dragDelta)&&(!(Math.abs(s)<this.dragDeltaX&&Math.abs(a)<this.dragDeltaY)&&(s>this.dragDeltaX*this.minDragDistance?this.colIdx==this.scene.logic.numCol-1?(this.draggable=!1,!1):(console.log("Candy "+this.rowIdx+" - "+this.colIdx+"  Right"),this.draggable=!1,this.scene.onSwapCandy(this,{x:0,y:1}),!0):s<-1*this.dragDeltaX*this.minDragDistance?0==this.colIdx?(this.draggable=!1,!1):(console.log("Candy "+this.rowIdx+" - "+this.colIdx+"  Left"),this.draggable=!1,this.scene.onSwapCandy(this,{x:0,y:-1}),!0):a>this.dragDeltaY*this.minDragDistance?this.rowIdx==this.scene.logic.numRow-1?(this.draggable=!1,!1):(console.log("Candy "+this.rowIdx+" - "+this.colIdx+"  Down"),this.draggable=!1,this.scene.onSwapCandy(this,{x:1,y:0}),!0):a<-1*this.dragDeltaY*this.minDragDistance?0==this.rowIdx?(this.draggable=!1,!1):(console.log("Candy "+this.rowIdx+" - "+this.colIdx+"  Up"),this.draggable=!1,this.scene.onSwapCandy(this,{x:-1,y:0}),!0):(this.draggable=!1,!1)))}onDragEnd(e,i,t,s){this.draggable=!0,this.tileSprite.setTexture("tiles")}}class n extends Phaser.GameObjects.Sprite{constructor(e,i,t){super(e.scene,e.x,e.y,"tiles"),this.setScale(e.scaleWidth,e.scaleHeight),this.rowIdx=i,this.colIdx=t,this.candySprite=null,this.setInteractive(),this.scene.input.setDraggable(this),this.draggable=!0,this.on("drag",this.onDrag),this.on("dragend",this.onDragEnd),this.on("pointerdown",this.onPointDown),this.on("pointerup",this.onPointUp),this.depth=0}onPointDown(){this.setTexture("tiles-selected"),this.pointup=!1}onPointUp(){this.setTexture("tiles")}onDrag(e,i,t){0!=this.draggable&&1==this.candySprite.onDrag(e,i,t)&&(this.draggable=!1)}onDragEnd(e,i,t,s){this.draggable=!0,this.candySprite.onDragEnd(e,i,t,s),this.setTexture("tiles")}}class o extends class{constructor(e){this.scene=e}}{constructor(e){super(e),this.tilesImage=null,this.numRow=0,this.numCol=0,this.colBuffer=50,this.rowBuffer=350,this.tileWidthAtScale=0,this.tileHeightAtScale=0,this.tileScaleWidth=1,this.tileScaleHeight=1,this.logicalCandyGrid=null,this.logicalTileGrid=null,this.level=null,this.originX=0,this.originY=0,this.tileGrid=null,this.candyGrid=null}initLevel(){console.log(""),this.level=this.scene.cache.json.get("this.level")}initMetrics(){this.numRow=this.level.tiles.length,this.numCol=this.level.tiles[0].length,this.tilesImage=this.scene.textures.get("tiles").getSourceImage(),this.scene.scale.gameSize.width<this.tilesImage.width*this.numCol+this.colBuffer?(this.tileWidthAtScale=this.tilesImage.width*(this.scene.scale.gameSize.width/(this.tilesImage.width*this.numCol+this.colBuffer)),this.tileScaleWidth=this.tileWidthAtScale/this.tilesImage.width):this.tileWidthAtScale=this.tilesImage.width,this.scene.scale.gameSize.height<this.tilesImage.height*this.numRow+this.rowBuffer?(this.tileHeightAtScale=this.tilesImage.height*(this.scene.scale.gameSize.height/(this.tilesImage.height*this.numRow+this.rowBuffer)),this.tileScaleHeight=this.tileHeightAtScale/this.tilesImage.height):this.tileHeightAtScale=this.tilesImage.height,this.tileScaleHeight<this.tileScaleWidth?(this.tileScaleWidth=this.tileScaleHeight,this.tileWidthAtScale=this.tilesImage.width*this.tileScaleWidth):(this.tileScaleHeight=this.tileScaleWidth,this.tileHeightAtScale=this.tilesImage.height*this.tileScaleHeight),this.calculateOriginGrid()}initGrid(){var e=0,i=-1*this.tileHeightAtScale;this.tileGrid=this.scene.add.container(this.originX,this.originY),this.candyGrid=this.scene.add.container(this.originX,this.originY),this.logicalCandyGrid=new Array(this.numRow),this.logicalTileGrid=new Array(this.numRow);for(var t=0;t<this.level.tiles.length;t++){i+=this.tileHeightAtScale,this.logicalCandyGrid[t]=new Array(this.numCol),this.logicalTileGrid[t]=new Array(this.numCol);for(var s=0;s<this.level.tiles[0].length;s++){if(0!=this.level.tiles[t][s]){var o=new n({scene:this.scene,x:e,y:i,scaleWidth:this.tileScaleWidth,scaleHeight:this.tileScaleHeight},t,s),l=new a({scene:this.scene,x:e,y:i,scaleWidth:this.tileScaleWidth,scaleHeight:this.tileScaleHeight},t,s,this.level.tiles[t][s],o);o.candySprite=l,this.tileGrid.add(o),this.candyGrid.add(l),this.logicalCandyGrid[t][s]=l,this.logicalTileGrid[t][s]=o}e+=this.tileWidthAtScale}e=0}}calculateOriginGrid(){this.originX=this.scene.cameras.main.centerX-this.tileWidthAtScale*((this.numCol-1)/2),this.originY=this.scene.cameras.main.centerY-this.tileHeightAtScale*((this.numRow-2)/2)}resize(e){var i=e.width,t=e.height;this.scene.cameras.resize(i,t),this.scene.bg.setPosition(i/2,t/2),this.scene.bg.setScale(this.scene.scale.gameSize.width/this.scene.bg.width,this.scene.scale.gameSize.height/this.scene.bg.height),this.calculateOriginGrid(),this.tileGrid.setPosition(this.originX,this.originY),this.candyGrid.setPosition(this.originX,this.originY)}onSwapCandy(e,i){var t=this.logicalCandyGrid[e.rowIdx+i.x][e.colIdx+i.y];this.swapCandies(e,t),console.log("Before tween Candy x "+e.x+"-y "+e.y+" || Candy2 x "+t.x+"-y "+t.y),this.scene.animMain.performSwap(e,t)}performMatchingCandies(e,i){console.log("Done Timeline 1");var t=this.detectValidMove(e,i);console.log(t),1==t.possible?(this.performCrushing(t),this.performCreateSpecialCandy(t),this.performTopup(t)):(this.scene.animMain.performSwapBack(e,i),this.swapCandies(e,i))}swapCandies(e,i){this.logicalCandyGrid[e.rowIdx][e.colIdx]=i,this.logicalCandyGrid[i.rowIdx][i.colIdx]=e;var t=e.rowIdx,s=e.colIdx;e.rowIdx=i.rowIdx,e.colIdx=i.colIdx,i.rowIdx=t,i.colIdx=s;var a=e.tileSprite;e.tileSprite=i.tileSprite,i.tileSprite=a,i.tileSprite.candySprite=i,e.tileSprite.candySprite=e}detectValidMove(e,i){var t=new Object;t.possible=!1,t.candy=new Object,t.candyToSwap=new Object,t.candy.colCandies=[],t.candy.rowCandies=[],t.candyToSwap.colCandies=[],t.candyToSwap.rowCandies=[];var s=1,a=e.rowIdx-1;for(t.candy.type=e.type,t.candy.x=e.x,t.candy.y=e.y,t.candyToSwap.x=i.x,t.candyToSwap.y=i.y,t.candyToSwap.type=i.type,t.candy.colCandies.push({rowIdx:e.rowIdx,colIdx:e.colIdx});a>-1&&e.type==this.logicalCandyGrid[a][e.colIdx].type;)t.candy.colCandies.push({rowIdx:a,colIdx:e.colIdx}),a--,s++;for(a=e.rowIdx+1;a<this.numRow&&e.type==this.logicalCandyGrid[a][e.colIdx].type;)t.candy.colCandies.push({rowIdx:a,colIdx:e.colIdx}),a++,s++;s>=3?(t.possible=!0,console.log("Detected First Col"+JSON.stringify(t.candy.colCandies))):t.candy.colCandies=[];var n=1,o=e.colIdx-1;for(t.candy.rowCandies.push({rowIdx:e.rowIdx,colIdx:e.colIdx});o>-1&&e.type==this.logicalCandyGrid[e.rowIdx][o].type;)t.candy.rowCandies.push({rowIdx:e.rowIdx,colIdx:o}),o--,n++;for(o=e.colIdx+1;o<this.numCol&&e.type==this.logicalCandyGrid[e.rowIdx][o].type;)t.candy.rowCandies.push({rowIdx:e.rowIdx,colIdx:o}),o++,n++;n>=3?(t.possible=!0,console.log("Detected First Row"+JSON.stringify(t.candy.rowCandies))):t.candy.rowCandies=[];s=1,a=i.rowIdx-1;for(t.candyToSwap.colCandies.push({rowIdx:i.rowIdx,colIdx:i.colIdx});a>-1&&i.type==this.logicalCandyGrid[a][i.colIdx].type;)t.candyToSwap.colCandies.push({rowIdx:a,colIdx:i.colIdx}),a--,s++;for(a=i.rowIdx+1;a<this.numRow&&i.type==this.logicalCandyGrid[a][i.colIdx].type;)t.candyToSwap.colCandies.push({rowIdx:a,colIdx:i.colIdx}),a++,s++;s>=3?(t.possible=!0,console.log("Detected sencond Col"+JSON.stringify(t.candyToSwap.colCandies))):t.candyToSwap.colCandies=[];n=1,o=i.colIdx-1;for(t.candyToSwap.rowCandies.push({rowIdx:i.rowIdx,colIdx:i.colIdx});o>-1&&i.type==this.logicalCandyGrid[i.rowIdx][o].type;)t.candyToSwap.rowCandies.push({rowIdx:i.rowIdx,colIdx:o}),o--,n++;for(o=i.colIdx+1;o<this.numCol&&i.type==this.logicalCandyGrid[i.rowIdx][o].type;)t.candyToSwap.rowCandies.push({rowIdx:i.rowIdx,colIdx:o}),o++,n++;return n>=3?(t.possible=!0,console.log("Detected sencond Row"+JSON.stringify(t.candyToSwap.rowCandies))):t.candyToSwap.rowCandies=[],t}performCrushing(e){this.destroyCandies(e.candy.colCandies),this.destroyCandies(e.candy.rowCandies),this.destroyCandies(e.candyToSwap.colCandies),this.destroyCandies(e.candyToSwap.rowCandies)}destroyCandies(e){e.forEach((e=>{var i=this.logicalCandyGrid[e.rowIdx][e.colIdx];null!=i&&(i.play("explode"),i.once(Phaser.Animations.Events.ANIMATION_COMPLETE,(()=>{console.log("Destroyed candy "+i.rowIdx+" - "+i.colIdx),i.destroy()})),this.logicalCandyGrid[e.rowIdx][e.colIdx]=void 0)}))}performCreateSpecialCandy(e){if(e.candy.colCandies.length>3){let i=e.candy.colCandies[0].rowIdx,t=e.candy.colCandies[0].colIdx;this.createCandyAtPos(e.candy.x,e.candy.y,i,t,e.candy.type)}if(e.candy.rowCandies.length>3){let i=e.candy.rowCandies[0].rowIdx,t=e.candy.rowCandies[0].colIdx;this.createCandyAtPos(e.candy.x,e.candy.y,i,t,e.candy.type)}if(e.candyToSwap.colCandies.length>3){let i=e.candyToSwap.colCandies[0].rowIdx,t=e.candyToSwap.colCandies[0].colIdx;this.createCandyAtPos(e.candyToSwap.x,e.candyToSwap.y,i,t,e.candyToSwap.type)}if(e.candyToSwap.rowCandies.length>3){let i=e.candyToSwap.rowCandies[0].rowIdx,t=e.candyToSwap.rowCandies[0].colIdx;this.createCandyAtPos(e.candyToSwap.x,e.candyToSwap.y,i,t,e.candyToSwap.type)}}createCandyAtPos(e,i,t,s,n){var o=new a({scene:this.scene,x:e,y:i,scaleWidth:this.tileScaleWidth,scaleHeight:this.tileScaleHeight},t,s,n,this.logicalTileGrid[t][s],!0);this.candyGrid.add(o),this.logicalCandyGrid[t][s]=o}performTopup(e){}}class l extends Phaser.Scene{constructor(){super("Main Scene!"),this.bg=null,this.tilesImage=null,this.clickable=!0,this.logic=new o(this),this.animMain=new s(this)}preload(){console.log("Preload! This is console log!");var e="./src/assets/";this.load.image("bg",e+"bg.png"),this.load.json("this.level",e+"level/level-0.json"),this.load.image("tiles",e+"tiles.png"),this.load.image("treasure",e+"treasure.png"),this.load.image("phone",e+"phone.png"),this.load.image("zlp-coin",e+"zlp-coin.png"),this.load.image("watch",e+"watch.png"),this.load.image("treasure-s",e+"treasure-s.png"),this.load.image("phone-s",e+"phone-s.png"),this.load.image("zlp-coin-s",e+"zlp-coin-s.png"),this.load.image("watch-s",e+"watch-s.png"),this.load.image("tiles-selected",e+"tiles-selected.png"),this.load.spritesheet("boom",e+"explosion-1.png",{frameWidth:128,frameHeight:128,endFrame:15})}create(){console.log("Create! This is console log!"),this.animMain.initStaticComponents(),this.animMain.initAnimate(),this.logic.initLevel(),this.logic.initMetrics(),this.logic.initGrid(),this.scale.on("resize",this.resize,this)}update(){}resize(e,i,t,s){this.logic.resize(e)}onSwapCandy(e,i){this.logic.onSwapCandy(e,i)}performCrushing(e){this.destroyCandies(e.candy.colCandies),this.destroyCandies(e.candy.rowCandies),this.destroyCandies(e.candyToSwap.colCandies),this.destroyCandies(e.candyToSwap.rowCandies)}destroyCandies(e){e.forEach((e=>{var i=this.logicalCandyGrid[e.x][e.y];i.play("explode"),i.once(Phaser.Animations.Events.ANIMATION_COMPLETE,(()=>{console.log("Destroyed candy "+i.rowIdx+" - "+i.colIdx),i.destroy(),this.logicalCandyGrid[e.x][e.y]=void 0}))}))}}}]);